<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ===========================
       SECTION: META + PRE-PAINT THEME
       (runs before paint to avoid flash)
       =========================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resource Hub | Ducks in the Pool</title>

  <script>
    (function() {
      const savedTheme = localStorage.getItem("theme");
      const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
      const theme = savedTheme || (prefersDark ? "dark" : "light");
      document.documentElement.dataset.theme = theme;
      document.addEventListener("DOMContentLoaded", () => {
        document.body.dataset.theme = theme;
      });
      const accent = localStorage.getItem("accent") || "#0a84ff";
      document.documentElement.style.setProperty("--accent", accent);
      const meta = document.createElement("meta");
      meta.name = "theme-color";
      meta.content = theme === "dark" ? "#1c1c1e" : "#f7f8fa";
      document.head.appendChild(meta);
    })();
  </script>

  <!-- ===========================
       SECTION: STYLES (responsive + aligned toggles)
       =========================== -->
  <style>
    :root{
      --radius:10px; --blur:14px;
      --accent:#0a84ff; --accent-strong:#0066d6;
      --bg-light:#f7f8fa; --bg-dark:#111216;
      --text-light:#111; --text-dark:#f5f5f7;
      --palette-size:14px;
      --gap:10px;
    }

    [data-theme="light"]{
      --bg:var(--bg-light); --text:var(--text-light);
      --sidebar-bg: rgba(255,255,255,0.88); --sidebar-border: rgba(0,0,0,0.08);
      --card-bg: rgba(255,255,255,0.75); --card-border: rgba(0,0,0,0.06);
    }
    [data-theme="dark"]{
      --bg:var(--bg-dark); --text:var(--text-dark);
      --sidebar-bg: rgba(20,20,22,0.7); --sidebar-border: rgba(255,255,255,0.06);
      --card-bg: rgba(255,255,255,0.04); --card-border: rgba(255,255,255,0.06);
    }

    html,body{height:100%}
    body{
      margin:0; display:flex; height:100vh;
      font-family: -apple-system,BlinkMacSystemFont,"SF Pro Display","Segoe UI",Roboto,Arial,sans-serif;
      background:var(--bg); color:var(--text);
      transition: background .25s ease, color .25s ease;
    }

    /* ASIDE / SIDEBAR */
    aside{
      width:280px; min-width:220px;
      padding:1.1rem;
      display:flex; flex-direction:column; gap:var(--gap);
      border-right:1px solid var(--sidebar-border);
      background: linear-gradient(180deg, color-mix(in srgb,var(--accent)12%,var(--sidebar-bg)) 0%, var(--sidebar-bg) 100%);
      backdrop-filter: blur(var(--blur)) saturate(140%);
      box-sizing:border-box;
    }
    header{ font-size:1.15rem; font-weight:700; margin-bottom:0.25rem; }

    input[type="search"]{
      width:100%; padding:.5rem .8rem; border-radius:10px;
      border:1px solid rgba(0,0,0,.08); background: rgba(255,255,255,.22);
      color:inherit; outline:none; box-sizing:border-box;
    }
    [data-theme="dark"] input[type="search"]{ background: rgba(255,255,255,.04); border-color: rgba(255,255,255,.06); }

    /* Nav */
    .nav-section{ display:flex; flex-direction:column; gap:0.45rem; margin-top:6px; overflow:auto; padding-right:6px; }
    .nav-section button{
      text-align:left; padding:.55rem .8rem; border-radius:9px; border:none;
      background:transparent; color:inherit; font-weight:600; font-size:0.95rem;
      transition: transform .12s ease, background .12s ease;
    }
    .nav-section button:hover{ transform: translateX(6px); background: color-mix(in srgb,var(--accent)10%,transparent); }
    .nav-section button.active{ background:var(--accent-strong); color:#fff; box-shadow: 0 6px 18px color-mix(in srgb,var(--accent)18%, transparent); }

    /* TOGGLES ROW */
    .toggles-wrap{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-top:6px; }
    .toggles-left{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .toggles-right{ display:flex; gap:8px; align-items:center; }

    .icon-btn{
      width:40px; height:40px; border-radius:10px; border:none;
      display:inline-flex; align-items:center; justify-content:center;
      background:transparent; color:var(--text); cursor:pointer;
      font-size:16px; padding:0; box-sizing:border-box;
      transition: transform .12s ease, background .12s ease, box-shadow .12s ease;
    }
    .icon-btn.primary{ background: var(--accent); color:#fff; box-shadow:0 6px 16px color-mix(in srgb,var(--accent)14%,transparent); }
    .icon-btn.ghost{ background: transparent; border:1px solid rgba(0,0,0,0.04); }
    .icon-btn:hover{ transform: translateY(-2px); }

    /* Color palette (dots) */
    .color-palette{ display:flex; gap:8px; align-items:center; }
    .color-dot{
      width: var(--palette-size); height: var(--palette-size);
      border-radius:50%; cursor:pointer; border:2px solid rgba(255,255,255,0.06);
      box-sizing: border-box;
    }
    .color-dot.active{ outline:2px solid color-mix(in srgb, var(--accent)40%, transparent); transform: scale(1.08); }

    /* accessible select (hidden on wide screens) */
    #color-select{ display:none; padding:.45rem; border-radius:8px; border:1px solid rgba(0,0,0,.08); background:transparent; }

    /* MAIN */
    main{ flex:1; overflow-y:auto; padding:14px 22px; box-sizing:border-box; min-width:0; }
    h2{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      position:sticky; top:0; z-index:10; background: linear-gradient(180deg, rgba(0,0,0,0.02), transparent);
      padding:10px 0; margin:0 0 12px 0;
    }
    #show-all-toggle{ padding:.4rem .7rem; border-radius:9px; border:1px solid var(--card-border); background:transparent; cursor:pointer; }

    main #grid{
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap:12px;
      align-items:start;
    }
    .card{
      background:var(--card-bg); border-radius:12px; padding:12px; border:1px solid var(--card-border);
      display:flex; flex-direction:column; gap:8px; min-height:56px; box-sizing:border-box;
      transition: transform .12s ease, box-shadow .12s ease;
      position:relative;
    }
    .card:hover{ transform: translateY(-6px); box-shadow: 0 10px 30px rgba(0,0,0,0.08); }
    .card-header{ display:flex; align-items:center; justify-content:space-between; gap:8px; }
    .card-header strong{ font-size:1rem; margin:0; word-break:break-word; }
    .card small{ color:rgba(0,0,0,0.55); }

    .star{ cursor:pointer; font-size:1.05rem; color:rgba(0,0,0,0.45); background:transparent; border:none; }
    .star.active{ color:var(--accent-strong); }

    /* Floating controls */
    #to-top{ position:fixed; bottom:22px; right:22px; width:44px; height:44px; border-radius:9px; border:none; background:var(--accent); color:#fff; display:none; cursor:pointer; }
    #to-top.visible{ display:block; }

    .unhide-sidebar-btn{
      display:none; position:fixed; left:12px; bottom:80px; z-index:9999;
      width:44px; height:44px; border-radius:9px; border:none; display:flex; align-items:center; justify-content:center;
      font-size:18px; cursor:pointer; background:var(--accent); color:#fff; box-shadow:0 6px 18px rgba(0,0,0,0.18);
    }
    body.hide-sidebar .unhide-sidebar-btn{ display:flex; }

    /* Responsive: collapse aside to top row */
    @media (max-width:900px){
      aside{ width:100%; height:auto; flex-direction:row; align-items:center; gap:12px; padding:10px; border-right: none; border-bottom:1px solid var(--sidebar-border); }
      .nav-section{ flex-direction:row; gap:8px; margin:0; overflow:auto; padding:6px 0; }
      .nav-section button{ white-space:nowrap; padding:.45rem .65rem; font-size:0.9rem; border-radius:8px; }
      .toggles-wrap{ order:2; flex:1; justify-content:flex-end; }
      main{ padding:12px; }
    }

    /* Small screens: switch to select for accessibility */
    @media (max-width:560px){
      main #grid{ grid-template-columns: repeat(1, 1fr); gap:10px; }
      .icon-btn{ width:36px; height:36px; font-size:14px; border-radius:8px; }
      .color-dot{ width:12px; height:12px; }
      .color-palette{ display:none; }
      #color-select{ display:block; }
    }
  </style>
</head>

<body>
  <!-- ASIDE / LEFT SIDEBAR -->
  <aside>
    <div style="display:flex; flex-direction:column; gap:8px; flex:1; min-width:0;">
      <header>Resource Hub</header>

      <!-- Search -->
      <input id="search" type="search" placeholder="Search‚Ä¶" aria-label="Search resources" />

      <!-- Nav container (populated from links.json) -->
      <div class="nav-section" id="nav-section" role="navigation" aria-label="Resource groups"></div>
    </div>

    <!-- TOGGLES (layout toggle removed) -->
    <div class="toggles-wrap" aria-hidden="false">
      <div class="toggles-left">
        <button id="theme-toggle"   type="button" class="icon-btn primary" title="Toggle theme">üåô</button>
        <button id="compact-toggle" type="button" class="icon-btn" title="Toggle compact view">üìè</button>
        <button id="sidebar-toggle" type="button" class="icon-btn" title="Hide sidebar">‚´∑</button>
        <button id="grid-size-toggle" type="button" class="icon-btn" title="Cycle grid columns">‚ñ¶</button>
      </div>

      <div class="toggles-right">
        <!-- Accent color dots (wide screens) -->
        <div class="color-palette" id="color-palette" aria-hidden="true"></div>
        <!-- Accessible select for small screens -->
        <select id="color-select" aria-label="Choose accent color"></select>
      </div>
    </div>
  </aside>

  <!-- MAIN CONTENT -->
  <main id="content">
    <h2>
      <span id="section-title"></span>
      <div>
        <button id="show-all-toggle" type="button">Show All</button>
      </div>
    </h2>

    <!-- Grid container -->
    <div id="grid" aria-live="polite"></div>
  </main>

  <!-- FLOATING UI -->
  <button id="to-top" type="button" aria-label="Scroll to top">‚Üë</button>
  <button id="unhide-sidebar-btn" class="unhide-sidebar-btn" type="button" aria-label="Show sidebar">‚´∏</button>

  <!-- SCRIPTS -->
  <script src="dashboard.js" defer></script>

  <script>
    (function(){
      /* to-top */
      const topBtn = document.getElementById('to-top');
      if (topBtn) {
        function updateTop(){ topBtn.classList.toggle('visible', window.scrollY > 400); }
        window.addEventListener('scroll', updateTop, { passive: true });
        topBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
        updateTop();
      }

      /* unhide sidebar helper */
      const unhideBtn = document.getElementById('unhide-sidebar-btn');
      if (unhideBtn) {
        unhideBtn.addEventListener('click', (e) => {
          e.preventDefault();
          document.body.classList.remove('hide-sidebar');
          try { localStorage.removeItem('hide-sidebar'); } catch(e){}
        });
        const obs = new MutationObserver(() => {
          unhideBtn.style.display = document.body.classList.contains('hide-sidebar') ? 'flex' : 'none';
        });
        obs.observe(document.body, { attributes: true, attributeFilter: ['class'] });
        unhideBtn.style.display = document.body.classList.contains('hide-sidebar') ? 'flex' : 'none';
      }
    })();
  </script>
</body>
</html>
