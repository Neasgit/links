<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <!-- ================================================
       SECTION 010: HEAD META
       - Base metadata + theme-color (synced in SECTION 020 script)
  ================================================== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Resource Hub | Ducks in the Pool</title>
  <meta name="theme-color" content="#e9edf3" />
  <!-- bump ?v when you change CSS to bust cache on GitHub Pages -->
  <link rel="stylesheet" href="styles.css?v=3" />

  <!-- ================================================
       SECTION 020: BOOT THEME/APPEARANCE
       - Runs ASAP to avoid FOUC (flash of unstyled content)
       - Sets data-theme + --accent and keeps meta theme-color in sync
  ================================================== -->
  <script>
    (() => {
      const THEME_KEY  = "theme";      // "auto" | "light" | "dark"
      const ACCENT_KEY = "accent";     // "#RRGGBB"
      const docEl   = document.documentElement;
      const themeEl = document.querySelector('meta[name="theme-color"]');
      const mql     = window.matchMedia("(prefers-color-scheme: dark)");

      const savedTheme  = localStorage.getItem(THEME_KEY)  || "auto";
      const savedAccent = localStorage.getItem(ACCENT_KEY) || "#0a84ff";

      // Apply accent early (prevents color pop-in)
      docEl.style.setProperty("--accent", savedAccent);

      function computeTheme(base){
        return base === "auto" ? (mql.matches ? "dark" : "light") : base;
      }
      function applyTheme(base){
        const actual = computeTheme(base);
        docEl.dataset.theme = actual;
        // NOTE: light mode background darkened to #e9edf3 for contrast
        if (themeEl) themeEl.content = actual === "dark" ? "#111216" : "#e9edf3";
      }

      applyTheme(savedTheme);

      // If user chose Auto, follow OS changes live
      mql.addEventListener?.("change", () => {
        if ((localStorage.getItem(THEME_KEY) || "auto") === "auto") applyTheme("auto");
      });

      // Expose tiny API so dashboard.js can update without duplicating logic
      window.__hubTheme = {
        setTheme(next){ localStorage.setItem(THEME_KEY, next); applyTheme(next); },
        setAccent(next){ localStorage.setItem(ACCENT_KEY, next); docEl.style.setProperty("--accent", next); }
      };
    })();
  </script>
</head>

<body>
  <!-- ================================================
       SECTION 030: SIDEBAR (SEARCH + NAV + ACTIONS)
  ================================================== -->
  <aside aria-label="Sidebar">
    <div class="aside-top">
      <header>Resource Hub</header>
      <input id="search" type="search" placeholder="Search…" aria-label="Search resources"/>
      <nav class="nav-section" id="nav-section" aria-label="Sections"></nav>
    </div>

    <div class="aside-actions">
      <button id="theme-toggle" class="icon-btn primary" type="button" aria-label="Toggle theme"></button>
      <button id="settings-btn" class="icon-btn" type="button" title="Settings" aria-haspopup="dialog" aria-controls="settings-overlay">⚙️</button>
    </div>
  </aside>

  <!-- ================================================
       SECTION 040: MAIN CONTENT (TITLE + GRID)
       - Sidebar toggle button shows only when sidebar is collapsed
  ================================================== -->
  <main>
    <button id="sidebar-toggle" class="icon-btn" type="button" title="Open sidebar" aria-expanded="true" aria-controls="nav-section">☰</button>
    <h2>
      <span id="section-title">Loading…</span>
      <button id="show-all-toggle" type="button" aria-pressed="false">Show All</button>
    </h2>
    <div id="grid" role="region" aria-live="polite"></div>
  </main>

  <!-- ================================================
       SECTION 050: SETTINGS PANEL (SLIDE-OVER DIALOG)
  ================================================== -->
  <div id="settings-overlay" role="dialog" aria-modal="true" aria-label="Settings">
    <div id="settings-panel">
      <header class="settings-header">
        <h2>Settings</h2>
        <button id="settings-close" class="icon-btn" type="button" aria-label="Close settings">✕</button>
      </header>

      <!-- APPEARANCE -->
      <section class="settings-group">
        <h3>Appearance</h3>

        <div class="setting">
          <div class="setting-label">Theme</div>
          <div class="radio-pills" role="radiogroup" aria-label="Theme">
            <label class="pill"><input type="radio" name="theme" value="auto" checked><span>Auto</span></label>
            <label class="pill"><input type="radio" name="theme" value="light"><span>Light</span></label>
            <label class="pill"><input type="radio" name="theme" value="dark"><span>Dark</span></label>
          </div>
        </div>

        <div class="setting">
          <div class="setting-label">Accent <small class="muted">Pick a base, then nudge brightness</small></div>
          <div class="swatch-row">
            <!-- Contrast-tuned palette -->
            <button class="swatch" style="background:#0a84ff" data-color="#0a84ff" aria-label="Blue"   type="button"></button>
            <button class="swatch" style="background:#7c3aed" data-color="#7c3aed" aria-label="Violet" type="button"></button>
            <button class="swatch" style="background:#06b6d4" data-color="#06b6d4" aria-label="Cyan"   type="button"></button>
            <button class="swatch" style="background:#ef4444" data-color="#ef4444" aria-label="Red"    type="button"></button>
            <button class="swatch" style="background:#f97316" data-color="#f97316" aria-label="Orange" type="button"></button>
            <button class="swatch" style="background:#16a34a" data-color="#16a34a" aria-label="Green"  type="button"></button>
            <button class="swatch" style="background:#db2777" data-color="#db2777" aria-label="Pink"   type="button"></button>
          </div>
          <div class="range-row">
            <label for="accent-brightness">Accent Brightness</label>
            <input type="range" id="accent-brightness" min="-30" max="30" step="1" value="0">
          </div>
        </div>

        <div class="setting">
          <div class="setting-label">Compact Mode</div>
          <label class="switch">
            <input id="compact-mode" type="checkbox">
            <span class="track"></span>
            <span class="thumb"></span>
          </label>
        </div>
      </section>

      <!-- LAYOUT -->
      <section class="settings-group">
        <h3>Layout</h3>
        <div class="setting">
          <div class="setting-label">Default View</div>
          <div class="radio-pills" role="radiogroup" aria-label="Default view">
            <label class="pill"><input type="radio" name="default-view" value="all" checked><span>All</span></label>
            <label class="pill"><input type="radio" name="default-view" value="first"><span>First Group</span></label>
            <label class="pill"><input type="radio" name="default-view" value="favs"><span>Favourites</span></label>
          </div>
        </div>
      </section>

      <!-- DATA -->
      <section class="settings-group">
        <h3>Data</h3>
        <div class="button-row">
          <button id="export-settings" class="btn primary" type="button">Export Settings</button>
          <button id="import-settings" class="btn subtle" type="button">Import Settings</button>
          <input id="import-file" type="file" accept="application/json" hidden>
        </div>

        <div class="setting">
          <label class="checkbox-row">
            <input type="checkbox" id="confirm-reset" checked>
            <span>Confirm before clearing all saved preferences</span>
          </label>
          <button id="reset-settings" class="btn danger" type="button">Reset All</button>
        </div>
      </section>
    </div>
  </div>

  <!-- ================================================
       SECTION 060: APP SCRIPT
  ================================================== -->
  <script src="dashboard.js" defer></script>
</body>
</html>
