<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Resource Hub</title>
<link rel="icon" href="https://www.ionos.co.uk/favicon.ico" />
<style>
:root {
  --bg:#f7f9fc; --ink:#0f172a; --muted:#64748b; --card:#fff;
  --accent:#0049b0; --accent-hover:#0072ff;
  --shadow:0 2px 10px rgba(0,0,0,0.06);
}
body.dark {
  --bg:#0b1224; --ink:#e5e7eb; --muted:#9ca3af; --card:#141c33;
  --accent:#0098db; --accent-hover:#00bcd4;
  --shadow:0 4px 16px rgba(0,0,0,0.4);
}
body {
  margin:0; background:var(--bg); color:var(--ink);
  font:15px/1.6 system-ui,Inter,Roboto;
  transition:background .3s,color .3s;
}
header {
  display:flex; justify-content:space-between; align-items:center;
  padding:16px 24px; background:var(--card);
  box-shadow:var(--shadow);
}
h1 {margin:0;font-weight:800;}
select, input[type=search], button {
  border:none; border-radius:8px; padding:8px 12px;
  font:inherit; background:var(--card);
  box-shadow:0 1px 4px rgba(0,0,0,0.05);
}
button {
  background:var(--accent); color:#fff; cursor:pointer; font-weight:600;
}
button:hover {background:var(--accent-hover);}
main {padding:20px;}
.card {
  background:var(--card); border-radius:10px; padding:18px;
  box-shadow:var(--shadow);
}
a {color:var(--accent); text-decoration:none; font-weight:600;}
a:hover {text-decoration:underline;}
.pill {display:inline-block;padding:3px 8px;border-radius:999px;font-size:12px;font-weight:600;margin-top:8px;}
.pill.int{background:#fee2e2;color:#7f1d1d;}
.pill.ext{background:#dcfce7;color:#065f46;}
/* Layout: grid */
.grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:16px;}
/* Layout: portal */
.portal {column-count:3;column-gap:1rem;}
@media(max-width:900px){.portal{column-count:2}}
@media(max-width:600px){.portal{column-count:1}}
.portal .card{display:inline-block;width:100%;margin:0 0 1rem;}
/* Layout: split */
#splitLayout {display:flex;flex-wrap:wrap;gap:1rem;}
#splitLayout aside {flex:1 1 250px;max-width:280px;}
#splitLayout main {flex:3 1 600px;}
.dark-toggle {margin-left:8px;}
</style>
</head>
<body>
<header>
  <h1>Resource Hub</h1>
  <div>
    <input id="q" type="search" placeholder="Search...">
    <select id="layout">
      <option value="grid">Grid</option>
      <option value="portal">Portal</option>
      <option value="split">Split</option>
      <option value="command">Command Palette</option>
    </select>
    <button id="themeToggle" class="dark-toggle">Theme</button>
  </div>
</header>

<main id="container"></main>

<!-- Command Palette Overlay -->
<div id="overlay" style="position:fixed;top:0;left:0;width:100%;height:100%;display:none;align-items:flex-start;justify-content:center;background:rgba(0,0,0,0.5);padding-top:100px;">
  <div style="background:var(--card);border-radius:10px;padding:12px;width:500px;max-width:90%;">
    <input id="cmdInput" placeholder="Search links..." style="width:100%;padding:8px;border:none;border-radius:6px;">
    <ul id="cmdResults" style="list-style:none;padding:0;margin:10px 0 0;max-height:300px;overflow:auto;"></ul>
  </div>
</div>

<script>
let data=[]; let dark=false;
const qEl=document.getElementById('q');
const container=document.getElementById('container');
const layoutSel=document.getElementById('layout');
const overlay=document.getElementById('overlay');
const cmdInput=document.getElementById('cmdInput');
const cmdResults=document.getElementById('cmdResults');

document.getElementById('themeToggle').onclick=()=>{dark=!dark;document.body.classList.toggle('dark',dark);};

fetch('links.json').then(r=>r.json()).then(j=>{data=j.groups;render();});

layoutSel.onchange=()=>render();
qEl.oninput=()=>render();

function render(){
  const mode=layoutSel.value;
  const q=(qEl.value||'').toLowerCase();
  const all=data.flatMap(g=>g.items).filter(i=>
    !q || i.title.toLowerCase().includes(q) || (i.notes||'').toLowerCase().includes(q)
  );

  if(mode==='grid'){
    container.className='grid';
    container.innerHTML=all.map(i=>`
      <div class="card">
        <a href="${i.url}" target="_blank">${i.title}</a>
        <div>${i.notes||''}</div>
        <span class="pill ${i.vis==='internal'?'int':'ext'}">${i.vis}</span>
      </div>`).join('');
  }

  else if(mode==='portal'){
    container.className='portal';
    container.innerHTML=all.map(i=>`
      <div class="card">
        <a href="${i.url}" target="_blank">${i.title}</a><br>
        <small>${i.notes||''}</small><br>
        <span class="pill ${i.vis==='internal'?'int':'ext'}">${i.vis}</span>
      </div>`).join('');
  }

  else if(mode==='split'){
    container.className='';
    const clicks=JSON.parse(localStorage.getItem('hub.clicks')||'{}');
    const asideList=`<aside><h3>Top Links</h3><ul>${Object.entries(clicks).sort((a,b)=>b[1]-a[1]).slice(0,5).map(([t,c])=>`<li>${t} (${c})</li>`).join('')||'<li>No data yet</li>'}</ul></aside>`;
    const mainList=data.map(g=>`
      <div class="card">
        <h3>${g.title}</h3>
        <ul>${g.items.map(i=>`<li><a href="${i.url}" target="_blank">${i.title}</a> â€“ ${i.notes||''}</li>`).join('')}</ul>
      </div>`).join('');
    container.innerHTML=`<div id="splitLayout">${asideList}<main>${mainList}</main></div>`;
    container.querySelectorAll('a').forEach(a=>{
      a.onclick=()=>{const t=a.textContent.trim();clicks[t]=(clicks[t]||0)+1;localStorage.setItem('hub.clicks',JSON.stringify(clicks));};
    });
  }

  else if(mode==='command'){
    openCommand();
  }
}

// ===== Command Palette =====
function openCommand(){
  overlay.style.display='flex';
  cmdInput.focus();
  cmdInput.value='';
  renderCmd();
}
function closeCommand(){
  overlay.style.display='none';
  cmdResults.innerHTML='';
}
document.addEventListener('keydown',e=>{
  if(e.key==='Escape')closeCommand();
});
cmdInput.oninput=renderCmd;
function renderCmd(){
  const q=cmdInput.value.toLowerCase();
  const items=data.flatMap(g=>g.items).filter(i=>!q||i.title.toLowerCase().includes(q)||(i.notes||'').toLowerCase().includes(q));
  cmdResults.innerHTML=items.slice(0,25).map(i=>`<li style="padding:8px;border-radius:6px;cursor:pointer;" data-url="${i.url}">${i.title}</li>`).join('');
}
cmdResults.onclick=e=>{
  if(e.target.dataset.url)window.open(e.target.dataset.url,'_blank');
  closeCommand();
};
</script>
</body>
</html>
