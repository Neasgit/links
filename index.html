<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Resource Hub | Ducks in the Pool</title>

  <!-- üß† Pre-paint theme & accent fix (runs before paint) -->
  <script>
    (function() {
      const savedTheme = localStorage.getItem("theme");
      const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
      const theme = savedTheme || (prefersDark ? "dark" : "light");
      document.documentElement.dataset.theme = theme;
      document.addEventListener("DOMContentLoaded", () => {
        document.body.dataset.theme = theme;
      });
      const accent = localStorage.getItem("accent") || "#0a84ff";
      document.documentElement.style.setProperty("--accent", accent);
      const meta = document.createElement("meta");
      meta.name = "theme-color";
      meta.content = theme === "dark" ? "#1c1c1e" : "#f7f8fa";
      document.head.appendChild(meta);
    })();
  </script>

  <style>
    /* =========================
       Base UI variables + layout
       ========================= */
    :root {
      --radius: 10px;
      --blur: 18px;
      --accent: #0a84ff;
      --bg-light: #f7f8fa;
      --bg-dark: #1c1c1e;
      --text-light: #111;
      --text-dark: #f5f5f7;
    }

    [data-theme="light"] {
      --bg: var(--bg-light);
      --text: var(--text-light);
      --sidebar-bg: rgba(255, 255, 255, 0.85);
      --sidebar-border: rgba(0, 0, 0, 0.08);
      --card-bg: rgba(255, 255, 255, 0.6);
      --card-border: rgba(0, 0, 0, 0.05);
    }

    [data-theme="dark"] {
      --bg: var(--bg-dark);
      --text: var(--text-dark);
      --sidebar-bg: rgba(30, 30, 32, 0.6);
      --sidebar-border: rgba(255, 255, 255, 0.08);
      --card-bg: rgba(255, 255, 255, 0.06);
      --card-border: rgba(255, 255, 255, 0.06);
    }

    body {
      margin: 0;
      display: flex;
      height: 100vh;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s ease, color 0.3s ease;
    }

    aside {
      width: 260px;
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      border-right: 1px solid var(--sidebar-border);
      background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--accent) 15%, var(--sidebar-bg)) 0%,
        var(--sidebar-bg) 100%
      );
      backdrop-filter: blur(var(--blur)) saturate(180%);
    }

    header {
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }

    input[type="search"] {
      width: 100%;
      padding: 0.5rem 0.8rem;
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.1);
      background: rgba(255, 255, 255, 0.3);
      color: inherit;
      transition: all 0.2s ease;
    }

    [data-theme="dark"] input[type="search"] {
      border-color: rgba(255, 255, 255, 0.15);
      background: rgba(255, 255, 255, 0.08);
    }

    .nav-section {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      margin-top: 1rem;
    }

    .nav-section button {
      text-align: left;
      padding: 0.55rem 0.9rem;
      border-radius: var(--radius);
      border: none;
      background: transparent;
      color: inherit;
      font-weight: 500;
      transition: all 0.25s ease;
    }

    .nav-section button:hover {
      transform: translateX(2px);
      background: color-mix(in srgb, var(--accent) 10%, transparent);
    }

    .nav-section button.active {
      background: var(--accent);
      color: #fff;
      font-weight: 600;
      box-shadow: 0 0 8px color-mix(in srgb, var(--accent) 40%, transparent);
    }

    .inline-toggles {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-top: 1rem;
      flex-wrap: wrap;
    }

    .icon-btn {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: none;
      background: var(--accent);
      color: #fff;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s ease, box-shadow 0.3s;
    }

    .icon-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 10px color-mix(in srgb, var(--accent) 30%, transparent);
    }

    .color-palette {
      display: flex;
      gap: 5px;
    }

    .color-dot {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .color-dot.active {
      border-color: var(--text);
    }

    main {
      flex: 1;
      overflow-y: auto;
      padding: 0 2rem 1.4rem;
    }

    h2 {
      position: sticky;
      top: 0;
      z-index: 10;
      background: var(--bg);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      margin-top: 0;
      margin-bottom: 0.4rem;
      color: var(--accent);
    }

    #show-all-toggle {
      font-size: 0.85rem;
      padding: 0.35rem 0.7rem;
      border-radius: 8px;
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s ease;
    }

    #show-all-toggle.active {
      background: var(--accent);
      color: #fff;
    }

    .card {
      background: var(--card-bg);
      border-left: 3px solid var(--accent);
      border-radius: var(--radius);
      padding: 0.5rem 0.9rem;
      border: 1px solid var(--card-border);
      margin-bottom: 0.45rem;
      min-height: 52px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      backdrop-filter: blur(12px) saturate(160%);
      transition: background 0.3s, transform 0.2s, box-shadow 0.3s;
    }

    .card:hover {
      background: color-mix(in srgb, var(--accent) 12%, var(--card-bg));
      box-shadow: 0 4px 12px color-mix(in srgb, var(--accent) 15%, transparent);
      transform: translateY(-2px);
    }

    .card small {
      display: block;
      opacity: 0.75;
      margin-top: 0.25rem;
    }

    .star {
      position: absolute;
      right: 10px;
      top: 8px;
      font-size: 1rem;
      cursor: pointer;
      color: #888;
    }

    .star.active {
      color: var(--accent);
    }

    .section-group {
      margin-bottom: 1rem;
    }

    .section-group h3 {
      margin: 0.8rem 0 0.4rem 0;
      color: var(--accent);
      font-size: 1rem;
    }

    #to-top {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 42px;
      height: 42px;
      border-radius: 50%;
      background: var(--accent);
      color: #fff;
      border: none;
      font-size: 1.3rem;
      display: none;
      cursor: pointer;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      transition: opacity 0.3s, transform 0.3s;
    }

    #to-top.visible {
      display: block;
      opacity: 0.9;
    }

    #to-top:hover {
      transform: scale(1.1);
    }

    /* === Default grid / list rules === */
    body.vertical-layout main #grid {
      display: flex;
      flex-direction: column;
    }

    body:not(.vertical-layout) main #grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 0.7rem;
    }

    /* === Compact mode visual rules === */
    body.compact .card {
      padding: 0.35rem 0.6rem;
      font-size: 0.9rem;
      min-height: 38px;
    }

    body.compact .card strong {
      font-weight: 500;
    }

    body.compact .card small {
      display: none;
    }

    /* =========================
       Additional toggles CSS
       ========================= */

    /* Hide sidebar */
    body.hide-sidebar aside { display: none; }
    body.hide-sidebar main { padding-left: 2rem; }

    /* Grid size presets (overrides default grid-template when set) */
    body.grid-1 main #grid { grid-template-columns: repeat(1, 1fr); }
    body.grid-2 main #grid { grid-template-columns: repeat(2, 1fr); }
    body.grid-3 main #grid { grid-template-columns: repeat(3, 1fr); }

    /* Card size presets */
    body.card-small .card { padding: .25rem .5rem; font-size: .88rem; min-height: 40px; }
    body.card-medium .card { padding: .5rem .9rem; font-size: 1rem; min-height: 52px; }
    body.card-large .card { padding: .9rem 1.2rem; font-size: 1.05rem; min-height: 72px; }

    /* Images toggle (works if cards contain <img>) */
    body.images-hidden .card img { display: none; }

    /* High contrast mode */
    body.high-contrast {
      --card-bg: #ffffff;
      --bg: #000000;
      --text: #ffffff;
      --accent: #00ff6a;
    }
    body.high-contrast .icon-btn { box-shadow: 0 0 8px var(--accent); }

    @media (max-width: 800px) {
      body { flex-direction: column; }
      aside { flex-direction: row; width: 100%; overflow-x: auto; }
      body.hide-sidebar aside { display: none; }
    }
  </style>
</head>

<body>
  <aside>
    <div>
      <header>Resource Hub</header>
      <input id="search" type="search" placeholder="Search‚Ä¶" />
      <div class="nav-section" id="nav-section"></div>
    </div>

    <div class="inline-toggles">
      <!-- Core toggles -->
      <button id="theme-toggle" class="icon-btn" title="Toggle Light/Dark">üåô</button>
      <button id="layout-toggle" class="icon-btn" title="Toggle Layout">‚áÜ</button>
      <button id="compact-toggle" class="icon-btn" title="Toggle Compact">üìè</button>

      <!-- Extra toggles (copy-paste friendly) -->
      <button id="sidebar-toggle" class="icon-btn" title="Toggle Sidebar">‚´∑</button>
      <button id="grid-size-toggle" class="icon-btn" title="Cycle Grid Size">‚ñ¶</button>
      <button id="card-size-toggle" class="icon-btn" title="Cycle Card Size">üûÜ</button>
      <button id="images-toggle" class="icon-btn" title="Toggle Images">üñºÔ∏è</button>
      <button id="contrast-toggle" class="icon-btn" title="High Contrast">‚ö´</button>

      <div class="color-palette" id="color-palette" aria-hidden="true"></div>
    </div>
  </aside>

  <main id="content">
    <h2>
      <span id="section-title"></span>
      <button id="show-all-toggle">Show All</button>
    </h2>

    <div id="grid"></div>
  </main>

  <button id="to-top" aria-label="Scroll to top">‚Üë</button>

  <!-- existing external dashboard logic (keeps functioning) -->
  <script src="dashboard.js" defer></script>

  <!-- small helpers & toggle handlers (keeps icons in sync and persists new toggles) -->
  <script>
    /* Utility: toggle class and persist to localStorage */
    function toggleClassPersist(cls, iconElem, onGlyph, offGlyph) {
      const enabled = document.body.classList.toggle(cls);
      localStorage.setItem(cls, enabled ? "true" : "false");
      if (iconElem) iconElem.textContent = enabled ? (onGlyph ?? iconElem.textContent) : (offGlyph ?? iconElem.textContent);
      return enabled;
    }

    /* Smooth scroll to top button */
    const topBtn = document.getElementById("to-top");
    window.addEventListener("scroll", () => {
      topBtn.classList.toggle("visible", window.scrollY > 400);
    });
    topBtn.addEventListener("click", () => window.scrollTo({ top: 0, behavior: "smooth" }));

    document.addEventListener("DOMContentLoaded", () => {
      // Elements
      const layoutToggle = document.getElementById("layout-toggle");
      const compactToggle = document.getElementById("compact-toggle");
      const themeToggle = document.getElementById("theme-toggle");
      const sidebarBtn = document.getElementById("sidebar-toggle");
      const gridBtn = document.getElementById("grid-size-toggle");
      const cardBtn = document.getElementById("card-size-toggle");
      const imagesBtn = document.getElementById("images-toggle");
      const contrastBtn = document.getElementById("contrast-toggle");

      /* -------------------------
         Theme toggle (keeps original behavior compatible)
         ------------------------ */
      if (themeToggle) {
        themeToggle.addEventListener("click", () => {
          const newTheme = document.body.dataset.theme === "dark" ? "light" : "dark";
          document.body.dataset.theme = newTheme;
          document.documentElement.dataset.theme = newTheme;
          localStorage.setItem("theme", newTheme);
          // reflect icon
          themeToggle.textContent = newTheme === "dark" ? "üåû" : "üåô";
        });
        // initial icon
        themeToggle.textContent = document.body.dataset.theme === "dark" ? "üåû" : "üåô";
      }

      /* -------------------------
         Layout toggle: vertical vs grid (persist)
         ------------------------ */
      if (layoutToggle) {
        layoutToggle.addEventListener("click", () => {
          const enabled = toggleClassPersist("vertical-layout", layoutToggle, "‚¨ç", "‚áÜ");
          // keep dashboard.js behavior compatible (they may also toggle)
        });
      }
      // restore persisted layout state
      if (localStorage.getItem("vertical-layout") === "true" || localStorage.getItem("vertical-layout") === "true") {
        document.body.classList.add("vertical-layout");
      }
      // set initial icon
      layoutToggle.textContent = document.body.classList.contains("vertical-layout") ? "‚¨ç" : "‚áÜ";

      /* -------------------------
         Compact toggle (persist)
         ------------------------ */
      if (compactToggle) {
        compactToggle.addEventListener("click", () => {
          const enabled = toggleClassPersist("compact", compactToggle, "üîé", "üìè");
          // If dashboard.js has its own applyCompact, it will read localStorage; this keeps both in sync.
        });
      }
      if (localStorage.getItem("compact") === "true") {
        document.body.classList.add("compact");
      }
      compactToggle.textContent = document.body.classList.contains("compact") ? "üîé" : "üìè";

      /* -------------------------
         Sidebar toggle
         ------------------------ */
      if (sidebarBtn) {
        sidebarBtn.addEventListener("click", () => {
          toggleClassPersist("hide-sidebar", sidebarBtn, "‚´∏", "‚´∑");
        });
        if (localStorage.getItem("hide-sidebar") === "true") {
          document.body.classList.add("hide-sidebar");
          sidebarBtn.textContent = "‚´∏";
        }
      }

      /* -------------------------
         Grid size (cycle 1 -> 2 -> 3 -> auto)
         ------------------------ */
      const GRID_KEYS = ["grid-1", "grid-2", "grid-3"];
      function getCurrentGridIndex() {
        return GRID_KEYS.findIndex(k => document.body.classList.contains(k));
      }
      if (gridBtn) {
        gridBtn.addEventListener("click", () => {
          let idx = getCurrentGridIndex();
          GRID_KEYS.forEach(k => document.body.classList.remove(k));
          idx = (idx + 1) % (GRID_KEYS.length + 1); // extra = auto (no class)
          if (idx < GRID_KEYS.length) {
            document.body.classList.add(GRID_KEYS[idx]);
            localStorage.setItem("grid-class", GRID_KEYS[idx]);
            gridBtn.textContent = (idx + 1) + "‚ñ¶";
          } else {
            localStorage.removeItem("grid-class");
            gridBtn.textContent = "‚ñ¶";
          }
        });
        const savedGrid = localStorage.getItem("grid-class");
        if (savedGrid && GRID_KEYS.includes(savedGrid)) {
          document.body.classList.add(savedGrid);
          gridBtn.textContent = (GRID_KEYS.indexOf(savedGrid) + 1) + "‚ñ¶";
        }
      }

      /* -------------------------
         Card size cycle (S/M/L)
         ------------------------ */
      const CARD_KEYS = ["card-small", "card-medium", "card-large"];
      if (cardBtn) {
        cardBtn.addEventListener("click", () => {
          let idx = CARD_KEYS.findIndex(k => document.body.classList.contains(k));
          CARD_KEYS.forEach(k => document.body.classList.remove(k));
          idx = (idx + 1) % CARD_KEYS.length;
          document.body.classList.add(CARD_KEYS[idx]);
          localStorage.setItem("card-class", CARD_KEYS[idx]);
          cardBtn.textContent = ["S", "M", "L"][idx];
        });
        const savedCard = localStorage.getItem("card-class") || "card-medium";
        document.body.classList.add(savedCard);
        cardBtn.textContent = savedCard === "card-small" ? "S" : (savedCard === "card-large" ? "L" : "M");
      }

      /* -------------------------
         Images toggle
         ------------------------ */
      if (imagesBtn) {
        imagesBtn.addEventListener("click", () => {
          toggleClassPersist("images-hidden", imagesBtn, "üñºÔ∏è", "üñºÔ∏è");
        });
        if (localStorage.getItem("images-hidden") === "true") {
          document.body.classList.add("images-hidden");
        }
      }

      /* -------------------------
         High contrast toggle
         ------------------------ */
      if (contrastBtn) {
        contrastBtn.addEventListener("click", () => {
          toggleClassPersist("high-contrast", contrastBtn, "‚ö™", "‚ö´");
        });
        if (localStorage.getItem("high-contrast") === "true") {
          document.body.classList.add("high-contrast");
          contrastBtn.textContent = "‚ö™";
        }
      }

      /* -------------------------
         MutationObserver: keep icons synced to classes (works even if other scripts toggle classes)
         ------------------------ */
      const obs = new MutationObserver(() => {
        if (layoutToggle) layoutToggle.textContent = document.body.classList.contains("vertical-layout") ? "‚¨ç" : "‚áÜ";
        if (compactToggle) compactToggle.textContent = document.body.classList.contains("compact") ? "üîé" : "üìè";
        if (sidebarBtn) sidebarBtn.textContent = document.body.classList.contains("hide-sidebar") ? "‚´∏" : "‚´∑";
        // gridBtn and cardBtn are left to their own text which is set on click/restore
        if (contrastBtn) contrastBtn.textContent = document.body.classList.contains("high-contrast") ? "‚ö™" : "‚ö´";
      });
      obs.observe(document.body, { attributes: true, attributeFilter: ["class"] });
    });
  </script>
</body>
</html>
