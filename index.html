<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Resource Hub</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#f8fafc;
  --ink:#0f172a;
  --card:#ffffff;
  --muted:#64748b;
  --accent:#2563eb;
  --accent-hover:#1d4ed8;
  --header-bg:rgba(255,255,255,0.8);
  --header-ink:#0f172a;
  --blur:blur(12px);
  --fade:opacity .3s ease, background .3s ease, color .3s ease;
  --header-height:60px;
}

/* ===== THEMES ===== */
body.light {
  --bg:#f8fafc;--card:#ffffff;--ink:#0f172a;--muted:#64748b;
  --accent:#2563eb;--accent-hover:#1d4ed8;
  --header-bg:rgba(255,255,255,0.7);--header-ink:#0f172a;
}
body.dark {
  --bg:#0e1117;--card:#161b22;--ink:#e6edf3;--muted:#9ca3af;
  --accent:#3b82f6;--accent-hover:#60a5fa;
  --header-bg:rgba(22,27,34,0.7);--header-ink:#e6edf3;
}

/* ===== CORE LAYOUT ===== */
body {
  margin:0;
  background:var(--bg);
  color:var(--ink);
  font:15px/1.6 "Inter",sans-serif;
  transition:var(--fade);
}

header {
  backdrop-filter:var(--blur);
  -webkit-backdrop-filter:var(--blur);
  background:var(--header-bg);
  color:var(--header-ink);
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 20px;
  box-shadow:0 2px 8px rgba(0,0,0,0.15);
  position:sticky;
  top:0;
  z-index:10;
  transition:var(--fade);
  height:var(--header-height);
}
h1{margin:0;font-weight:800;font-size:1.3rem;}
header .actions{display:flex;align-items:center;gap:8px;}
input[type=search]{
  border:none;border-radius:8px;padding:8px 12px;
  font:inherit;background:var(--card);color:var(--ink);
  box-shadow:0 1px 4px rgba(0,0,0,0.05);
}
button{
  border:none;border-radius:8px;padding:8px 12px;
  font-weight:600;cursor:pointer;transition:background .3s,color .3s,border .3s;
}
button.toggle{background:var(--accent);color:#fff;}
button.toggle:hover{background:var(--accent-hover);}
button.reset{
  background:var(--card);color:var(--ink);
  border:1px solid var(--muted);
}
button.reset:hover{
  background:var(--accent);color:#fff;border-color:var(--accent);
}

main{padding:20px;transition:var(--fade);}
.card{
  background:var(--card);
  border-radius:10px;
  padding:18px;
  box-shadow:0 0 10px rgba(0,0,0,0.15);
  margin-bottom:1rem;
  transition:var(--fade);
}
a{color:var(--accent);text-decoration:none;font-weight:600;transition:var(--fade);}
a:hover{text-decoration:underline;}
.editable{cursor:pointer;}
.editable:hover{background:rgba(0,0,0,0.05);}
.pill{
  display:inline-block;padding:3px 8px;border-radius:999px;
  font-size:12px;font-weight:600;margin-top:6px;
}
.pill.int{background:#fee2e2;color:#7f1d1d;}
.pill.ext{background:#dcfce7;color:#065f46;}
.star{
  cursor:pointer;margin-right:6px;font-size:15px;opacity:.7;
}
.star.active{color:gold;opacity:1;}

/* ===== SPLIT VIEW ===== */
#splitLayout {
  display:flex;
  flex-wrap:nowrap;
  gap:1.5rem;
  align-items:flex-start;
  transition:var(--fade);
}

aside.sidebar {
  flex:0 0 270px;
  background:var(--card);
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,0.15);
  padding:16px;
  height:fit-content;
  align-self:flex-start;
  position:sticky;
  top:calc(var(--header-height) + 20px);
  margin-top:0;
}
aside h3 {
  margin-top:0;
  margin-bottom:6px;
  font-size:1rem;
  font-weight:700;
  border-bottom:1px solid var(--muted);
  padding-bottom:4px;
}
aside ul{list-style:none;padding-left:0;margin-top:4px;}
aside li{margin-bottom:6px;font-size:0.95rem;}
aside li a{color:var(--accent);}
aside li a:hover{text-decoration:underline;}

#splitLayout main{flex:1;min-width:0;}

/* Toast */
.toast{
  position:fixed;
  bottom:16px;
  right:16px;
  background:var(--accent);
  color:#fff;
  padding:8px 14px;
  border-radius:8px;
  font-weight:600;
  opacity:0;
  pointer-events:none;
  transition:opacity .4s ease;
}
.toast.show{opacity:1;}
</style>
</head>

<body class="light">
<header>
  <h1>Resource Hub</h1>
  <div class="actions">
    <input id="q" type="search" placeholder="Search..." />
    <button id="toggleMode" class="toggle">üåû Light</button>
    <button id="resetNotes" class="reset">‚Ü∫ Reset Notes</button>
  </div>
</header>

<main id="container"></main>
<div id="toast" class="toast">‚úì Saved</div>

<script>
let data=[];
const qEl=document.getElementById('q');
const container=document.getElementById('container');
const toggleBtn=document.getElementById('toggleMode');
const resetBtn=document.getElementById('resetNotes');
const toast=document.getElementById('toast');

/* ==== SYSTEM AUTO DETECTION ==== */
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)');
let theme = localStorage.getItem('hub.theme') || (prefersDark.matches ? 'dark' : 'light');
applyTheme();

prefersDark.addEventListener('change', e => {
  if (localStorage.getItem('hub.theme') === 'system') {
    theme = e.matches ? 'dark' : 'light';
    applyTheme();
  }
});

toggleBtn.onclick = () => {
  if (theme === 'light') theme = 'dark';
  else if (theme === 'dark') theme = 'system';
  else theme = 'light';
  localStorage.setItem('hub.theme', theme);
  if (theme === 'system') theme = prefersDark.matches ? 'dark' : 'light';
  applyTheme();
};

resetBtn.onclick = () => {
  if (confirm('Clear all custom notes?')) {
    localStorage.removeItem('hub.customNotes');
    renderSplit();
  }
};

function applyTheme(){
  document.body.className = theme;
  toggleBtn.textContent = theme === 'dark' ? 'üåô Dark' : (theme === 'system' ? 'üñ•Ô∏è System' : 'üåû Light');
}

/* ==== LOAD DATA ==== */
fetch('links.json').then(r=>r.json()).then(j=>{
  data=j.groups;
  renderSplit();
});
qEl.oninput=()=>renderSplit();

/* ==== STORAGE HELPERS ==== */
function getCustomNotes(){return JSON.parse(localStorage.getItem('hub.customNotes')||'{}');}
function saveCustomNotes(o){localStorage.setItem('hub.customNotes',JSON.stringify(o));}
function getFavs(){return JSON.parse(localStorage.getItem('hub.favs')||'[]');}
function saveFavs(arr){localStorage.setItem('hub.favs',JSON.stringify(arr));}

/* ==== SPLIT VIEW ==== */
function renderSplit(){
  const custom=getCustomNotes();
  const favs=getFavs();
  const q=(qEl.value||'').toLowerCase();
  const clicks=JSON.parse(localStorage.getItem('hub.clicks')||'{}');

  const topLinksList=Object.entries(clicks).sort((a,b)=>b[1]-a[1]).slice(0,8)
    .map(([t,c])=>{
      const item=data.flatMap(g=>g.items).find(i=>i.title===t);
      if(!item)return'';
      return `<li><a href="${item.url}" target="_blank">${item.title}</a> <span style="color:var(--muted)">(${c})</span></li>`;
    }).join('') || '<li>No data yet</li>';

  const favList=favs.length
    ? favs.map(t=>{
        const item=data.flatMap(g=>g.items).find(i=>i.title===t);
        return item ? `<li><a href="${item.url}" target="_blank">${item.title}</a></li>` : '';
      }).join('')
    : '<li>No favourites yet</li>';

  const sidebarHTML=`
    <aside class="sidebar">
      <h3>‚≠ê Favourites</h3>
      <ul>${favList}</ul>
      <h3>üìà Top Links</h3>
      <ul>${topLinksList}</ul>
    </aside>
  `;

  const mainList=data.map(g=>{
    const items=g.items.filter(i=>!q||i.title.toLowerCase().includes(q)||(i.notes||'').toLowerCase().includes(q));
    if(!items.length)return'';
    return `
    <div class="card">
      <h3>${g.title}</h3>
      <ul>${items.map(i=>{
        const starClass=favs.includes(i.title)?'active':'';
        return `
        <li>
          <span class="star ${starClass}" data-title="${i.title}">${favs.includes(i.title)?'‚òÖ':'‚òÜ'}</span>
          <a href="${i.url}" target="_blank">${i.title}</a> ‚Äì
          <span class="editable" data-title="${i.title}">${custom[i.title]||i.notes||''}</span>
        </li>`;
      }).join('')}
      </ul>
    </div>`;
  }).join('');

  container.innerHTML=`<div id="splitLayout">${sidebarHTML}<main>${mainList}</main></div>`;
  bindLinks();
  enableEditing();
  enableStars();
}

/* ==== HELPERS ==== */
function bindLinks(){
  container.querySelectorAll('a').forEach(a=>{
    a.onclick=()=>{const t=a.textContent.trim();
      const clicks=JSON.parse(localStorage.getItem('hub.clicks')||'{}');
      clicks[t]=(clicks[t]||0)+1;
      localStorage.setItem('hub.clicks',JSON.stringify(clicks));
    };
  });
}

function enableStars(){
  const stars=container.querySelectorAll('.star');
  let favs=getFavs();
  stars.forEach(s=>{
    s.onclick=()=>{
      const t=s.dataset.title;
      if(favs.includes(t)) favs=favs.filter(x=>x!==t);
      else favs.push(t);
      saveFavs(favs);
      renderSplit();
    };
  });
}

function showToast(){
  toast.classList.add('show');
  setTimeout(()=>toast.classList.remove('show'),900);
}

/* ==== INLINE EDITING ==== */
function enableEditing(){
  const edits=container.querySelectorAll('.editable');
  const custom=getCustomNotes();
  edits.forEach(el=>{
    el.onclick=()=>{
      const t=el.dataset.title;
      const current=custom[t]||el.textContent.trim();
      const input=document.createElement('input');
      input.value=current;input.style.width='90%';
      el.replaceWith(input);
      input.focus();
      input.onblur=()=>save();
      input.onkeydown=(e)=>{if(e.key==='Enter')save();}
      function save(){
        const newVal=input.value.trim();
        custom[t]=newVal;
        saveCustomNotes(custom);
        input.replaceWith(el);
        el.textContent=newVal;
        showToast();
      }
    };
  });
}
</script>
</body>
</html>
